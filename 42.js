(self.webpackChunkalfa_tm_reports_converter=self.webpackChunkalfa_tm_reports_converter||[]).push([[42],{4347:(r,e,t)=>{"use strict";t.r(e),t.d(e,{AlfaReportParsingService:()=>S});var n=t(1459),u="История сделок",o=["Сделки из торговой платформы","Сделки с акциями"],i=["Покупка","Продажа"],c=["Дивиденды"],a=["Удержание налога при поступлении дивидендов"],s=t(5853),f=new Date(0,0,0,12,0,0,0),p=function(r,e,t){return r["".concat(e).concat(t)]},l=function(r,e,t){var n=p(r,e,t);return"string"!=typeof(null==n?void 0:n.v)?b("string",e,t):(0,s.Z)(n.v,"dd.MM.yyyy",f)},v=function(r,e,t){var n=p(r,e,t);return"number"!=typeof(null==n?void 0:n.v)?b("number",e,t):Number(n.v)},d=function(r,e,t){var n=p(r,e,t);return"string"!=typeof(null==n?void 0:n.v)?b("string",e,t):n.v},b=function(r,e,t){throw new Error("Expected to be ".concat(r," in ").concat(e).concat(t," cell"))},y=function(r,e){var t=p(r,"B",e);if(!t)return{incorrectFormat:!0};var n=t.v;if(!m(n))return{notSupportedType:!0};var u=!!p(r,"K",e);return{result:{date:l(r,u?"K":"A",e),type:n,price:v(r,"C",e),priceCurrency:d(r,"D",e),count:v(r,"E",e),instrument:d(r,"F",e),ticker:d(r,"G",e),isin:d(r,"H",e),sum:v(r,"I",e),sumCurrency:d(r,"J",e)}}},m=function(r){return i.includes(r)},w=function(r,e){var t=p(r,"B",e);return t?c.includes(String(t.v))?{result:{date:l(r,"A",e),incomeForOne:v(r,"C",e),currency:d(r,"D",e),count:v(r,"E",e),instrument:d(r,"F",e),ticker:d(r,"G",e),isin:d(r,"H",e),gross:v(r,"I",e)}}:{notSupportedType:!0}:{incorrectFormat:!0}};function g(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,n)}return t}function h(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?g(Object(t),!0).forEach((function(e){O(r,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))}))}return r}function O(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var k=/.+акциям (.+) (\d+\.00)/,j=function(r,e){var t=p(r,"B",e);if(!t)return{incorrectFormat:!0};var n=String(t.v);return a.find((function(r){return n.includes(r)}))?{result:h(h({},P(n,e)),{},{date:l(r,"A",e),sum:v(r,"I",e),currency:d(r,"J",e)})}:{notSupportedType:!0}},P=function(r,e){var t=k.exec(r);if(null==t)throw new Error("Can't parse cell B".concat(e));return{instrument:t[1],count:Number(t[2])}};function x(r,e,t,n,u,o,i){try{var c=r[o](i),a=c.value}catch(r){return void t(r)}c.done?e(a):Promise.resolve(a).then(n,u)}var E=/\d+$/,S=function r(){var e,t,o;!function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),e=this,t="parse",o=function(){var r,e=(r=regeneratorRuntime.mark((function r(e){var t,o,i,c,a,s,f,p,l,v,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.arrayBuffer();case 2:if(t=r.sent,o=(0,n.read)(t,{type:"array",sheets:u}),i=o.Sheets[u]){r.next=7;break}throw new Error("Incorrect file format");case 7:c=T(i),a={deals:[],incomes:[],outgoings:[],depositsWithdrawals:[]},s=null,f=5;case 11:if(!(f<c)){r.next=33;break}if(!(p=C(i,f)).skipRow){r.next=16;break}return s=null,r.abrupt("continue",30);case 16:p.newType&&(s=p.newType,f+=2),r.t0=s,r.next="deals"===r.t0?20:"income"===r.t0?23:"outgoings"===r.t0?26:"depositsWithdrawals"===r.t0?29:30;break;case 20:return"result"in(l=y(i,f))&&a.deals.push(l.result),r.abrupt("break",30);case 23:return"result"in(v=w(i,f))&&a.incomes.push(v.result),r.abrupt("break",30);case 26:return"result"in(d=j(i,f))&&a.outgoings.push(d.result),r.abrupt("break",30);case 29:return r.abrupt("break",30);case 30:f++,r.next=11;break;case 33:return r.abrupt("return",a);case 34:case"end":return r.stop()}}),r)})),function(){var e=this,t=arguments;return new Promise((function(n,u){var o=r.apply(e,t);function i(r){x(o,n,u,i,c,"next",r)}function c(r){x(o,n,u,i,c,"throw",r)}i(void 0)}))});return function(r){return e.apply(this,arguments)}}(),t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o},C=function(r,e){var t=function(r,e){var t;return String((null===(t=p(r,"A",e))||void 0===t?void 0:t.v)||"")}(r,e);if(!t)return{skipRow:!0};var n=D.find((function(r){return r.predicate(t)}));return n?{newType:n.type}:{}},D=[{type:"deals",predicate:function(r){return o.some((function(e){return r.includes(e)}))}},{type:"depositsWithdrawals",predicate:function(r){return r.includes("Пополнения/выводы с трастового счета")}},{type:"income",predicate:function(r){return"Информация по зачислениям"===r}},{type:"outgoings",predicate:function(r){return"Информация по списаниям"===r}}],T=function(r){var e=r["!ref"];if(!e)throw new Error("Incorrect file format");return Number(E.exec(e)[0])}},4130:()=>{}}]);